<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Toyota Canada News</title>
<style>
  body { font-family: sans-serif; margin:0; padding:0; background:#fff; }
  .header { background-color:#EB0A1E; color:white; padding:20px 40px; display:flex; justify-content:space-between; align-items:center; }
  .header h1 { margin:0; font-size:28px; }
  .article-list { padding:30px 40px; }
  .article { display:flex; margin-bottom:40px; border-bottom:1px solid #e0e0e0; padding-bottom:20px; }
  .article-content { flex:1; }
  .article-date { font-size:14px; color:#666666; margin-bottom:6px; }
  .article-title { font-size:20px; color:#EB0A1E; font-weight:700; margin:0 0 12px 0; }
  .article-title a { color:inherit; text-decoration:none; }
  .article-title a:hover { text-decoration:underline; }
  .article-desc { font-size:16px; color:#333333; line-height:1.5; }
  .article img { width:160px; height:auto; margin-left:20px; object-fit:cover; }
  .no-articles { font-size:18px; color:#999; text-align:center; margin-top:40px; }
  .error-details { font-size:14px; color:#666; text-align:center; margin-top:10px; font-family:monospace; }
</style>
</head>
<body>

<div class="header">
  <h1>Toyota Canada News</h1>
  <div id="timestamp">Loading...</div>
</div>

<div class="article-list" id="articles">
  <div class="no-articles">Loading articles...</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const container = document.getElementById('articles');
  const timestamp = document.getElementById('timestamp');

  // Use relative path - adjust based on where index.html is located
  // If index.html is in root and JSON is in powerbi/, use: 'powerbi/toyota_news.json'
  // If index.html is in powerbi/, use: 'toyota_news.json'
  const jsonUrl = 'powerbi/toyota_news.json?t=' + new Date().getTime();

  console.log('Fetching from:', jsonUrl); // Debug log

  fetch(jsonUrl)
    .then(res => {
      console.log('Response status:', res.status); // Debug log
      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`);
      }
      return res.json();
    })
    .then(data => {
      console.log('Data received:', data); // Debug log
      container.innerHTML = ''; // clear loading
      const articles = data.articles || [];
      timestamp.textContent = new Date(data.fetched_at).toLocaleString('en-CA', { 
        dateStyle:'medium', 
        timeStyle:'short' 
      });

      if (articles.length === 0) {
        container.innerHTML = '<div class="no-articles">No articles found.</div>';
        return;
      }

      articles.forEach(article => {
        const div = document.createElement('div');
        div.className = 'article';

        div.innerHTML = `
          <div class="article-content">
            <div class="article-date">${article.date}</div>
            <div class="article-title"><a href="${article.url}" target="_blank">${article.title}</a></div>
            <div class="article-desc">${article.description}</div>
          </div>
          ${article.image_url ? `<img src="${article.image_url}" alt="Article image">` : ''}
        `;
        container.appendChild(div);
      });
    })
    .catch(err => {
      console.error('Failed to load articles:', err);
      container.innerHTML = `
        <div class="no-articles">Failed to load articles.</div>
        <div class="error-details">${err.message}</div>
      `;
      timestamp.textContent = '';
    });
});
</script>

</body>
</html>